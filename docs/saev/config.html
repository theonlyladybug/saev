<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.3">
<title>saev.config API documentation</title>
<meta name="description" content="All configs for all saev jobs …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>saev.config</code></h1>
</header>
<section id="section-intro">
<p>All configs for all saev jobs.</p>
<h2 id="import-times">Import Times</h2>
<p>This module should be very fast to import so that <code>python main.py --help</code> is fast.
This means that the top-level imports should not include big packages like numpy, torch, etc.
For example, <code>TreeOfLife.n_imgs</code> imports numpy when it's needed, rather than importing it at the top level.</p>
<p>Also contains code for expanding configs with lists into lists of configs (grid search).
Might be expanded in the future to support pseudo-random sampling from distributions to support random hyperparameter search, as in <a href="https://github.com/samuelstevens/sax/blob/main/sax/sweep.py">this file</a>.</p>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="saev.config.expand"><code class="name flex">
<span>def <span class="ident">expand</span></span>(<span>config: dict[str, object]) ‑> Iterator[dict[str, object]]</span>
</code></dt>
<dd>
<div class="desc"><p>Expands dicts with (nested) lists into a list of (nested) dicts.</p></div>
</dd>
<dt id="saev.config.grid"><code class="name flex">
<span>def <span class="ident">grid</span></span>(<span>cfg: <a title="saev.config.Train" href="#saev.config.Train">Train</a>,<br>sweep_dct: dict[str, object]) ‑> tuple[list[<a title="saev.config.Train" href="#saev.config.Train">Train</a>], list[str]]</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="saev.config.Activations"><code class="flex name class">
<span>class <span class="ident">Activations</span></span>
<span>(</span><span>data: <a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a> | <a title="saev.config.ImageFolderDataset" href="#saev.config.ImageFolderDataset">ImageFolderDataset</a> | <a title="saev.config.Ade20kDataset" href="#saev.config.Ade20kDataset">Ade20kDataset</a> = &lt;factory&gt;,<br>dump_to: str = './shards',<br>vit_family: Literal['clip', 'siglip', 'dinov2', 'moondream2'] = 'clip',<br>vit_ckpt: str = 'ViT-L-14/openai',<br>vit_batch_size: int = 1024,<br>n_workers: int = 8,<br>d_vit: int = 1024,<br>vit_layers: list[int] = &lt;factory&gt;,<br>n_patches_per_img: int = 256,<br>cls_token: bool = True,<br>n_patches_per_shard: int = 2400000,<br>seed: int = 42,<br>ssl: bool = True,<br>device: str = 'cuda',<br>slurm: bool = False,<br>slurm_acct: str = 'PAS2136',<br>log_to: str = './logs')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for calculating and saving ViT activations.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Activations:
    &#34;&#34;&#34;
    Configuration for calculating and saving ViT activations.
    &#34;&#34;&#34;

    data: DatasetConfig = dataclasses.field(default_factory=ImagenetDataset)
    &#34;&#34;&#34;Which dataset to use.&#34;&#34;&#34;
    dump_to: str = os.path.join(&#34;.&#34;, &#34;shards&#34;)
    &#34;&#34;&#34;Where to write shards.&#34;&#34;&#34;
    vit_family: typing.Literal[&#34;clip&#34;, &#34;siglip&#34;, &#34;dinov2&#34;, &#34;moondream2&#34;] = &#34;clip&#34;
    &#34;&#34;&#34;Which model family.&#34;&#34;&#34;
    vit_ckpt: str = &#34;ViT-L-14/openai&#34;
    &#34;&#34;&#34;Specific model checkpoint.&#34;&#34;&#34;
    vit_batch_size: int = 1024
    &#34;&#34;&#34;Batch size for ViT inference.&#34;&#34;&#34;
    n_workers: int = 8
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    d_vit: int = 1024
    &#34;&#34;&#34;Dimension of the ViT activations (depends on model).&#34;&#34;&#34;
    vit_layers: list[int] = dataclasses.field(default_factory=lambda: [-2])
    &#34;&#34;&#34;Which layers to save. By default, the second-to-last layer.&#34;&#34;&#34;
    n_patches_per_img: int = 256
    &#34;&#34;&#34;Number of ViT patches per image (depends on model).&#34;&#34;&#34;
    cls_token: bool = True
    &#34;&#34;&#34;Whether the model has a [CLS] token.&#34;&#34;&#34;
    n_patches_per_shard: int = 2_400_000
    &#34;&#34;&#34;Number of activations per shard; 2.4M is approximately 10GB for 1024-dimensional 4-byte activations.&#34;&#34;&#34;

    seed: int = 42
    &#34;&#34;&#34;Random seed.&#34;&#34;&#34;
    ssl: bool = True
    &#34;&#34;&#34;Whether to use SSL.&#34;&#34;&#34;

    # Hardware
    device: str = &#34;cuda&#34;
    &#34;&#34;&#34;Which device to use.&#34;&#34;&#34;
    slurm: bool = False
    &#34;&#34;&#34;Whether to use `submitit` to run jobs on a Slurm cluster.&#34;&#34;&#34;
    slurm_acct: str = &#34;PAS2136&#34;
    &#34;&#34;&#34;Slurm account string.&#34;&#34;&#34;
    log_to: str = &#34;./logs&#34;
    &#34;&#34;&#34;Where to log Slurm job stdout/stderr.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Activations.cls_token"><code class="name">var <span class="ident">cls_token</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether the model has a [CLS] token.</p></div>
</dd>
<dt id="saev.config.Activations.d_vit"><code class="name">var <span class="ident">d_vit</span> : int</code></dt>
<dd>
<div class="desc"><p>Dimension of the ViT activations (depends on model).</p></div>
</dd>
<dt id="saev.config.Activations.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a> | <a title="saev.config.ImageFolderDataset" href="#saev.config.ImageFolderDataset">ImageFolderDataset</a> | <a title="saev.config.Ade20kDataset" href="#saev.config.Ade20kDataset">Ade20kDataset</a></code></dt>
<dd>
<div class="desc"><p>Which dataset to use.</p></div>
</dd>
<dt id="saev.config.Activations.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"><p>Which device to use.</p></div>
</dd>
<dt id="saev.config.Activations.dump_to"><code class="name">var <span class="ident">dump_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to write shards.</p></div>
</dd>
<dt id="saev.config.Activations.log_to"><code class="name">var <span class="ident">log_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to log Slurm job stdout/stderr.</p></div>
</dd>
<dt id="saev.config.Activations.n_patches_per_img"><code class="name">var <span class="ident">n_patches_per_img</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of ViT patches per image (depends on model).</p></div>
</dd>
<dt id="saev.config.Activations.n_patches_per_shard"><code class="name">var <span class="ident">n_patches_per_shard</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of activations per shard; 2.4M is approximately 10GB for 1024-dimensional 4-byte activations.</p></div>
</dd>
<dt id="saev.config.Activations.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.Activations.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"><p>Random seed.</p></div>
</dd>
<dt id="saev.config.Activations.slurm"><code class="name">var <span class="ident">slurm</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use <code>submitit</code> to run jobs on a Slurm cluster.</p></div>
</dd>
<dt id="saev.config.Activations.slurm_acct"><code class="name">var <span class="ident">slurm_acct</span> : str</code></dt>
<dd>
<div class="desc"><p>Slurm account string.</p></div>
</dd>
<dt id="saev.config.Activations.ssl"><code class="name">var <span class="ident">ssl</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use SSL.</p></div>
</dd>
<dt id="saev.config.Activations.vit_batch_size"><code class="name">var <span class="ident">vit_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for ViT inference.</p></div>
</dd>
<dt id="saev.config.Activations.vit_ckpt"><code class="name">var <span class="ident">vit_ckpt</span> : str</code></dt>
<dd>
<div class="desc"><p>Specific model checkpoint.</p></div>
</dd>
<dt id="saev.config.Activations.vit_family"><code class="name">var <span class="ident">vit_family</span> : Literal['clip', 'siglip', 'dinov2', 'moondream2']</code></dt>
<dd>
<div class="desc"><p>Which model family.</p></div>
</dd>
<dt id="saev.config.Activations.vit_layers"><code class="name">var <span class="ident">vit_layers</span> : list[int]</code></dt>
<dd>
<div class="desc"><p>Which layers to save. By default, the second-to-last layer.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.Ade20kDataset"><code class="flex name class">
<span>class <span class="ident">Ade20kDataset</span></span>
<span>(</span><span>root: str = './data/ade20k',<br>split: Literal['training', 'validation'] = 'training')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Ade20kDataset:
    &#34;&#34;&#34; &#34;&#34;&#34;

    root: str = os.path.join(&#34;.&#34;, &#34;data&#34;, &#34;ade20k&#34;)
    &#34;&#34;&#34;Where the class folders with images are stored.&#34;&#34;&#34;
    split: typing.Literal[&#34;training&#34;, &#34;validation&#34;] = &#34;training&#34;
    &#34;&#34;&#34;Data split.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        if self.split == &#34;validation&#34;:
            return 2000
        else:
            return 20210</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Ade20kDataset.root"><code class="name">var <span class="ident">root</span> : str</code></dt>
<dd>
<div class="desc"><p>Where the class folders with images are stored.</p></div>
</dd>
<dt id="saev.config.Ade20kDataset.split"><code class="name">var <span class="ident">split</span> : Literal['training', 'validation']</code></dt>
<dd>
<div class="desc"><p>Data split.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.Ade20kDataset.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    if self.split == &#34;validation&#34;:
        return 2000
    else:
        return 20210</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.DataLoad"><code class="flex name class">
<span>class <span class="ident">DataLoad</span></span>
<span>(</span><span>shard_root: str = './shards',<br>patches: Literal['cls', 'patches', 'meanpool'] = 'patches',<br>layer: int | Literal['all', 'meanpool'] = -2,<br>clamp: float = 100000.0,<br>n_random_samples: int = 524288,<br>scale_mean: bool | str = True,<br>scale_norm: bool | str = True)</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for loading activation data from disk.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class DataLoad:
    &#34;&#34;&#34;
    Configuration for loading activation data from disk.
    &#34;&#34;&#34;

    shard_root: str = os.path.join(&#34;.&#34;, &#34;shards&#34;)
    &#34;&#34;&#34;Directory with .bin shards and a metadata.json file.&#34;&#34;&#34;
    patches: typing.Literal[&#34;cls&#34;, &#34;patches&#34;, &#34;meanpool&#34;] = &#34;patches&#34;
    &#34;&#34;&#34;Which kinds of patches to use. &#39;cls&#39; indicates just the [CLS] token (if any). &#39;patches&#39; indicates it will return all patches. &#39;meanpool&#39; returns the mean of all image patches.&#34;&#34;&#34;
    layer: int | typing.Literal[&#34;all&#34;, &#34;meanpool&#34;] = -2
    &#34;&#34;&#34;.. todo: document this field.&#34;&#34;&#34;
    clamp: float = 1e5
    &#34;&#34;&#34;Maximum value for activations; activations will be clamped to within [-clamp, clamp]`.&#34;&#34;&#34;
    n_random_samples: int = 2**19
    &#34;&#34;&#34;Number of random samples used to calculate approximate dataset means at startup.&#34;&#34;&#34;
    scale_mean: bool | str = True
    &#34;&#34;&#34;Whether to subtract approximate dataset means from examples. If a string, manually load from the filepath.&#34;&#34;&#34;
    scale_norm: bool | str = True
    &#34;&#34;&#34;Whether to scale average dataset norm to sqrt(d_vit). If a string, manually load from the filepath.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.DataLoad.clamp"><code class="name">var <span class="ident">clamp</span> : float</code></dt>
<dd>
<div class="desc"><p>Maximum value for activations; activations will be clamped to within [-clamp, clamp]`.</p></div>
</dd>
<dt id="saev.config.DataLoad.layer"><code class="name">var <span class="ident">layer</span> : int | Literal['all', 'meanpool']</code></dt>
<dd>
<div class="desc"><p>.. todo: document this field.</p></div>
</dd>
<dt id="saev.config.DataLoad.n_random_samples"><code class="name">var <span class="ident">n_random_samples</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of random samples used to calculate approximate dataset means at startup.</p></div>
</dd>
<dt id="saev.config.DataLoad.patches"><code class="name">var <span class="ident">patches</span> : Literal['cls', 'patches', 'meanpool']</code></dt>
<dd>
<div class="desc"><p>Which kinds of patches to use. 'cls' indicates just the [CLS] token (if any). 'patches' indicates it will return all patches. 'meanpool' returns the mean of all image patches.</p></div>
</dd>
<dt id="saev.config.DataLoad.scale_mean"><code class="name">var <span class="ident">scale_mean</span> : bool | str</code></dt>
<dd>
<div class="desc"><p>Whether to subtract approximate dataset means from examples. If a string, manually load from the filepath.</p></div>
</dd>
<dt id="saev.config.DataLoad.scale_norm"><code class="name">var <span class="ident">scale_norm</span> : bool | str</code></dt>
<dd>
<div class="desc"><p>Whether to scale average dataset norm to sqrt(d_vit). If a string, manually load from the filepath.</p></div>
</dd>
<dt id="saev.config.DataLoad.shard_root"><code class="name">var <span class="ident">shard_root</span> : str</code></dt>
<dd>
<div class="desc"><p>Directory with .bin shards and a metadata.json file.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.ImageFolderDataset"><code class="flex name class">
<span>class <span class="ident">ImageFolderDataset</span></span>
<span>(</span><span>root: str = './data/split')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for a generic image folder dataset.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class ImageFolderDataset:
    &#34;&#34;&#34;Configuration for a generic image folder dataset.&#34;&#34;&#34;

    root: str = os.path.join(&#34;.&#34;, &#34;data&#34;, &#34;split&#34;)
    &#34;&#34;&#34;Where the class folders with images are stored.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires walking the directory structure. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
        n = 0
        for _, _, files in os.walk(self.root):
            n += len(files)
        return n</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.ImageFolderDataset.root"><code class="name">var <span class="ident">root</span> : str</code></dt>
<dd>
<div class="desc"><p>Where the class folders with images are stored.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.ImageFolderDataset.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires walking the directory structure. If you need to reference this number very often, cache it in a local variable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires walking the directory structure. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
    n = 0
    for _, _, files in os.walk(self.root):
        n += len(files)
    return n</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.ImagenetDataset"><code class="flex name class">
<span>class <span class="ident">ImagenetDataset</span></span>
<span>(</span><span>name: str = 'ILSVRC/imagenet-1k', split: str = 'train')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for HuggingFace Imagenet.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class ImagenetDataset:
    &#34;&#34;&#34;Configuration for HuggingFace Imagenet.&#34;&#34;&#34;

    name: str = &#34;ILSVRC/imagenet-1k&#34;
    &#34;&#34;&#34;Dataset name on HuggingFace. Don&#39;t need to change this..&#34;&#34;&#34;
    split: str = &#34;train&#34;
    &#34;&#34;&#34;Dataset split. For the default ImageNet-1K dataset, can either be &#39;train&#39;, &#39;validation&#39; or &#39;test&#39;.&#34;&#34;&#34;

    @property
    def n_imgs(self) -&gt; int:
        &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
        import datasets

        dataset = datasets.load_dataset(
            self.name, split=self.split, trust_remote_code=True
        )
        return len(dataset)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.ImagenetDataset.name"><code class="name">var <span class="ident">name</span> : str</code></dt>
<dd>
<div class="desc"><p>Dataset name on HuggingFace. Don't need to change this..</p></div>
</dd>
<dt id="saev.config.ImagenetDataset.split"><code class="name">var <span class="ident">split</span> : str</code></dt>
<dd>
<div class="desc"><p>Dataset split. For the default ImageNet-1K dataset, can either be 'train', 'validation' or 'test'.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.ImagenetDataset.n_imgs"><code class="name">prop <span class="ident">n_imgs</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def n_imgs(self) -&gt; int:
    &#34;&#34;&#34;Number of images in the dataset. Calculated on the fly, but is non-trivial to calculate because it requires loading the dataset. If you need to reference this number very often, cache it in a local variable.&#34;&#34;&#34;
    import datasets

    dataset = datasets.load_dataset(
        self.name, split=self.split, trust_remote_code=True
    )
    return len(dataset)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.SparseAutoencoder"><code class="flex name class">
<span>class <span class="ident">SparseAutoencoder</span></span>
<span>(</span><span>d_vit: int = 1024,<br>exp_factor: int = 16,<br>sparsity_coeff: float = 0.0004,<br>n_reinit_samples: int = 524288,<br>ghost_grads: bool = False,<br>remove_parallel_grads: bool = True,<br>normalize_w_dec: bool = True,<br>seed: int = 0)</span>
</code></dt>
<dd>
<div class="desc"><p>SparseAutoencoder(d_vit: int = 1024, exp_factor: int = 16, sparsity_coeff: float = 0.0004, n_reinit_samples: int = 524288, ghost_grads: bool = False, remove_parallel_grads: bool = True, normalize_w_dec: bool = True, seed: int = 0)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class SparseAutoencoder:
    d_vit: int = 1024
    exp_factor: int = 16
    &#34;&#34;&#34;Expansion factor for SAE.&#34;&#34;&#34;
    sparsity_coeff: float = 4e-4
    &#34;&#34;&#34;How much to weight sparsity loss term.&#34;&#34;&#34;
    n_reinit_samples: int = 1024 * 16 * 32
    &#34;&#34;&#34;Number of samples to use for SAE re-init. Anthropic proposes initializing b_dec to the geometric median of the dataset here: https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder-bias. We use the regular mean.&#34;&#34;&#34;
    ghost_grads: bool = False
    &#34;&#34;&#34;Whether to use ghost grads.&#34;&#34;&#34;
    remove_parallel_grads: bool = True
    &#34;&#34;&#34;Whether to remove gradients parallel to W_dec columns (which will be ignored because we force the columns to have unit norm). See https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder-optimization for the original discussion from Anthropic.&#34;&#34;&#34;
    normalize_w_dec: bool = True
    &#34;&#34;&#34;Whether to make sure W_dec has unit norm columns. See https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder for original citation.&#34;&#34;&#34;
    seed: int = 0
    &#34;&#34;&#34;Random seed.&#34;&#34;&#34;

    @property
    def d_sae(self) -&gt; int:
        return self.d_vit * self.exp_factor</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.SparseAutoencoder.d_vit"><code class="name">var <span class="ident">d_vit</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="saev.config.SparseAutoencoder.exp_factor"><code class="name">var <span class="ident">exp_factor</span> : int</code></dt>
<dd>
<div class="desc"><p>Expansion factor for SAE.</p></div>
</dd>
<dt id="saev.config.SparseAutoencoder.ghost_grads"><code class="name">var <span class="ident">ghost_grads</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use ghost grads.</p></div>
</dd>
<dt id="saev.config.SparseAutoencoder.n_reinit_samples"><code class="name">var <span class="ident">n_reinit_samples</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of samples to use for SAE re-init. Anthropic proposes initializing b_dec to the geometric median of the dataset here: <a href="https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder-bias.">https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder-bias.</a> We use the regular mean.</p></div>
</dd>
<dt id="saev.config.SparseAutoencoder.normalize_w_dec"><code class="name">var <span class="ident">normalize_w_dec</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to make sure W_dec has unit norm columns. See <a href="https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder">https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder</a> for original citation.</p></div>
</dd>
<dt id="saev.config.SparseAutoencoder.remove_parallel_grads"><code class="name">var <span class="ident">remove_parallel_grads</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to remove gradients parallel to W_dec columns (which will be ignored because we force the columns to have unit norm). See <a href="https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder-optimization">https://transformer-circuits.pub/2023/monosemantic-features/index.html#appendix-autoencoder-optimization</a> for the original discussion from Anthropic.</p></div>
</dd>
<dt id="saev.config.SparseAutoencoder.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"><p>Random seed.</p></div>
</dd>
<dt id="saev.config.SparseAutoencoder.sparsity_coeff"><code class="name">var <span class="ident">sparsity_coeff</span> : float</code></dt>
<dd>
<div class="desc"><p>How much to weight sparsity loss term.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.SparseAutoencoder.d_sae"><code class="name">prop <span class="ident">d_sae</span> : int</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def d_sae(self) -&gt; int:
    return self.d_vit * self.exp_factor</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="saev.config.Train"><code class="flex name class">
<span>class <span class="ident">Train</span></span>
<span>(</span><span>data: <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a> = &lt;factory&gt;,<br>n_workers: int = 32,<br>n_patches: int = 100000000,<br>sae: <a title="saev.config.SparseAutoencoder" href="#saev.config.SparseAutoencoder">SparseAutoencoder</a> = &lt;factory&gt;,<br>n_sparsity_warmup: int = 0,<br>lr: float = 0.0004,<br>n_lr_warmup: int = 500,<br>sae_batch_size: int = 16384,<br>track: bool = True,<br>wandb_project: str = 'saev',<br>tag: str = '',<br>log_every: int = 25,<br>ckpt_path: str = './checkpoints',<br>device: Literal['cuda', 'cpu'] = 'cuda',<br>seed: int = 42,<br>slurm: bool = False,<br>slurm_acct: str = 'PAS2136',<br>log_to: str = './logs')</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for training a sparse autoencoder on a vision transformer.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Train:
    &#34;&#34;&#34;
    Configuration for training a sparse autoencoder on a vision transformer.
    &#34;&#34;&#34;

    data: DataLoad = dataclasses.field(default_factory=DataLoad)
    &#34;&#34;&#34;Data configuration&#34;&#34;&#34;
    n_workers: int = 32
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    n_patches: int = 100_000_000
    &#34;&#34;&#34;Number of SAE training examples.&#34;&#34;&#34;
    sae: SparseAutoencoder = dataclasses.field(default_factory=SparseAutoencoder)
    &#34;&#34;&#34;SAE configuration.&#34;&#34;&#34;
    n_sparsity_warmup: int = 0
    &#34;&#34;&#34;Number of sparsity coefficient warmup steps.&#34;&#34;&#34;
    lr: float = 0.0004
    &#34;&#34;&#34;Learning rate.&#34;&#34;&#34;
    n_lr_warmup: int = 500
    &#34;&#34;&#34;Number of learning rate warmup steps.&#34;&#34;&#34;
    sae_batch_size: int = 1024 * 16
    &#34;&#34;&#34;Batch size for SAE training.&#34;&#34;&#34;

    # Logging
    track: bool = True
    &#34;&#34;&#34;Whether to track with WandB.&#34;&#34;&#34;
    wandb_project: str = &#34;saev&#34;
    &#34;&#34;&#34;WandB project name.&#34;&#34;&#34;
    tag: str = &#34;&#34;
    &#34;&#34;&#34;Tag to add to WandB run.&#34;&#34;&#34;
    log_every: int = 25
    &#34;&#34;&#34;How often to log to WandB.&#34;&#34;&#34;
    ckpt_path: str = os.path.join(&#34;.&#34;, &#34;checkpoints&#34;)
    &#34;&#34;&#34;Where to save checkpoints.&#34;&#34;&#34;

    device: typing.Literal[&#34;cuda&#34;, &#34;cpu&#34;] = &#34;cuda&#34;
    &#34;&#34;&#34;Hardware device.&#34;&#34;&#34;
    seed: int = 42
    &#34;&#34;&#34;Random seed.&#34;&#34;&#34;
    slurm: bool = False
    &#34;&#34;&#34;Whether to use `submitit` to run jobs on a Slurm cluster.&#34;&#34;&#34;
    slurm_acct: str = &#34;PAS2136&#34;
    &#34;&#34;&#34;Slurm account string.&#34;&#34;&#34;
    log_to: str = os.path.join(&#34;.&#34;, &#34;logs&#34;)
    &#34;&#34;&#34;Where to log Slurm job stdout/stderr.&#34;&#34;&#34;</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Train.ckpt_path"><code class="name">var <span class="ident">ckpt_path</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to save checkpoints.</p></div>
</dd>
<dt id="saev.config.Train.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a></code></dt>
<dd>
<div class="desc"><p>Data configuration</p></div>
</dd>
<dt id="saev.config.Train.device"><code class="name">var <span class="ident">device</span> : Literal['cuda', 'cpu']</code></dt>
<dd>
<div class="desc"><p>Hardware device.</p></div>
</dd>
<dt id="saev.config.Train.log_every"><code class="name">var <span class="ident">log_every</span> : int</code></dt>
<dd>
<div class="desc"><p>How often to log to WandB.</p></div>
</dd>
<dt id="saev.config.Train.log_to"><code class="name">var <span class="ident">log_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to log Slurm job stdout/stderr.</p></div>
</dd>
<dt id="saev.config.Train.lr"><code class="name">var <span class="ident">lr</span> : float</code></dt>
<dd>
<div class="desc"><p>Learning rate.</p></div>
</dd>
<dt id="saev.config.Train.n_lr_warmup"><code class="name">var <span class="ident">n_lr_warmup</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of learning rate warmup steps.</p></div>
</dd>
<dt id="saev.config.Train.n_patches"><code class="name">var <span class="ident">n_patches</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of SAE training examples.</p></div>
</dd>
<dt id="saev.config.Train.n_sparsity_warmup"><code class="name">var <span class="ident">n_sparsity_warmup</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of sparsity coefficient warmup steps.</p></div>
</dd>
<dt id="saev.config.Train.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.Train.sae"><code class="name">var <span class="ident">sae</span> : <a title="saev.config.SparseAutoencoder" href="#saev.config.SparseAutoencoder">SparseAutoencoder</a></code></dt>
<dd>
<div class="desc"><p>SAE configuration.</p></div>
</dd>
<dt id="saev.config.Train.sae_batch_size"><code class="name">var <span class="ident">sae_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for SAE training.</p></div>
</dd>
<dt id="saev.config.Train.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"><p>Random seed.</p></div>
</dd>
<dt id="saev.config.Train.slurm"><code class="name">var <span class="ident">slurm</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to use <code>submitit</code> to run jobs on a Slurm cluster.</p></div>
</dd>
<dt id="saev.config.Train.slurm_acct"><code class="name">var <span class="ident">slurm_acct</span> : str</code></dt>
<dd>
<div class="desc"><p>Slurm account string.</p></div>
</dd>
<dt id="saev.config.Train.tag"><code class="name">var <span class="ident">tag</span> : str</code></dt>
<dd>
<div class="desc"><p>Tag to add to WandB run.</p></div>
</dd>
<dt id="saev.config.Train.track"><code class="name">var <span class="ident">track</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to track with WandB.</p></div>
</dd>
<dt id="saev.config.Train.wandb_project"><code class="name">var <span class="ident">wandb_project</span> : str</code></dt>
<dd>
<div class="desc"><p>WandB project name.</p></div>
</dd>
</dl>
</dd>
<dt id="saev.config.Visuals"><code class="flex name class">
<span>class <span class="ident">Visuals</span></span>
<span>(</span><span>ckpt: str = './checkpoints/sae.pt',<br>data: <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a> = &lt;factory&gt;,<br>images: <a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a> | <a title="saev.config.ImageFolderDataset" href="#saev.config.ImageFolderDataset">ImageFolderDataset</a> | <a title="saev.config.Ade20kDataset" href="#saev.config.Ade20kDataset">Ade20kDataset</a> = &lt;factory&gt;,<br>top_k: int = 128,<br>n_workers: int = 16,<br>topk_batch_size: int = 16384,<br>sae_batch_size: int = 16384,<br>epsilon: float = 1e-09,<br>sort_by: Literal['cls', 'img', 'patch'] = 'patch',<br>device: str = 'cuda',<br>dump_to: str = './data',<br>log_freq_range: tuple[float, float] = (-6.0, -2.0),<br>log_value_range: tuple[float, float] = (-1.0, 1.0),<br>include_latents: list[int] = &lt;factory&gt;,<br>n_distributions: int = 25,<br>percentile: int = 99,<br>n_latents: int = 400,<br>seed: int = 42)</span>
</code></dt>
<dd>
<div class="desc"><p>Configuration for generating visuals from trained SAEs.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@beartype.beartype
@dataclasses.dataclass(frozen=True)
class Visuals:
    &#34;&#34;&#34;Configuration for generating visuals from trained SAEs.&#34;&#34;&#34;

    ckpt: str = os.path.join(&#34;.&#34;, &#34;checkpoints&#34;, &#34;sae.pt&#34;)
    &#34;&#34;&#34;Path to the sae.pt file.&#34;&#34;&#34;
    data: DataLoad = dataclasses.field(default_factory=DataLoad)
    &#34;&#34;&#34;Data configuration.&#34;&#34;&#34;
    images: DatasetConfig = dataclasses.field(default_factory=ImagenetDataset)
    &#34;&#34;&#34;Which images to use.&#34;&#34;&#34;
    top_k: int = 128
    &#34;&#34;&#34;How many images per SAE feature to store.&#34;&#34;&#34;
    n_workers: int = 16
    &#34;&#34;&#34;Number of dataloader workers.&#34;&#34;&#34;
    topk_batch_size: int = 1024 * 16
    &#34;&#34;&#34;Number of examples to apply top-k op to.&#34;&#34;&#34;
    sae_batch_size: int = 1024 * 16
    &#34;&#34;&#34;Batch size for SAE inference.&#34;&#34;&#34;
    epsilon: float = 1e-9
    &#34;&#34;&#34;Value to add to avoid log(0).&#34;&#34;&#34;
    sort_by: typing.Literal[&#34;cls&#34;, &#34;img&#34;, &#34;patch&#34;] = &#34;patch&#34;
    &#34;&#34;&#34;How to find the top k images. &#39;cls&#39; picks images where the SAE latents of the ViT&#39;s [CLS] token are maximized without any patch highligting. &#39;img&#39; picks images that maximize the sum of an SAE latent over all patches in the image, highlighting the patches. &#39;patch&#39; pickes images that maximize an SAE latent over all patches (not summed), highlighting the patches and only showing unique images.&#34;&#34;&#34;
    device: str = &#34;cuda&#34;
    &#34;&#34;&#34;Which accelerator to use.&#34;&#34;&#34;
    dump_to: str = os.path.join(&#34;.&#34;, &#34;data&#34;)
    &#34;&#34;&#34;Where to save data.&#34;&#34;&#34;
    log_freq_range: tuple[float, float] = (-6.0, -2.0)
    &#34;&#34;&#34;Log10 frequency range for which to save images.&#34;&#34;&#34;
    log_value_range: tuple[float, float] = (-1.0, 1.0)
    &#34;&#34;&#34;Log10 frequency range for which to save images.&#34;&#34;&#34;
    include_latents: list[int] = dataclasses.field(default_factory=list)
    &#34;&#34;&#34;Latents to always include, no matter what.&#34;&#34;&#34;
    n_distributions: int = 25
    &#34;&#34;&#34;Number of features to save distributions for.&#34;&#34;&#34;
    percentile: int = 99
    &#34;&#34;&#34;Percentile to estimate for outlier detection.&#34;&#34;&#34;
    n_latents: int = 400
    &#34;&#34;&#34;Maximum number of latents to save images for.&#34;&#34;&#34;
    seed: int = 42
    &#34;&#34;&#34;Random seed.&#34;&#34;&#34;

    @property
    def root(self) -&gt; str:
        return os.path.join(self.dump_to, f&#34;sort_by_{self.sort_by}&#34;)

    @property
    def top_values_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;top_values.pt&#34;)

    @property
    def top_img_i_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;top_img_i.pt&#34;)

    @property
    def top_patch_i_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;top_patch_i.pt&#34;)

    @property
    def mean_values_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;mean_values.pt&#34;)

    @property
    def sparsity_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;sparsity.pt&#34;)

    @property
    def distributions_fpath(self) -&gt; str:
        return os.path.join(self.root, &#34;distributions.pt&#34;)

    @property
    def percentiles_fpath(self) -&gt; str:
        return os.path.join(self.root, f&#34;percentiles_p{self.percentile}.pt&#34;)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="saev.config.Visuals.ckpt"><code class="name">var <span class="ident">ckpt</span> : str</code></dt>
<dd>
<div class="desc"><p>Path to the sae.pt file.</p></div>
</dd>
<dt id="saev.config.Visuals.data"><code class="name">var <span class="ident">data</span> : <a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a></code></dt>
<dd>
<div class="desc"><p>Data configuration.</p></div>
</dd>
<dt id="saev.config.Visuals.device"><code class="name">var <span class="ident">device</span> : str</code></dt>
<dd>
<div class="desc"><p>Which accelerator to use.</p></div>
</dd>
<dt id="saev.config.Visuals.dump_to"><code class="name">var <span class="ident">dump_to</span> : str</code></dt>
<dd>
<div class="desc"><p>Where to save data.</p></div>
</dd>
<dt id="saev.config.Visuals.epsilon"><code class="name">var <span class="ident">epsilon</span> : float</code></dt>
<dd>
<div class="desc"><p>Value to add to avoid log(0).</p></div>
</dd>
<dt id="saev.config.Visuals.images"><code class="name">var <span class="ident">images</span> : <a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a> | <a title="saev.config.ImageFolderDataset" href="#saev.config.ImageFolderDataset">ImageFolderDataset</a> | <a title="saev.config.Ade20kDataset" href="#saev.config.Ade20kDataset">Ade20kDataset</a></code></dt>
<dd>
<div class="desc"><p>Which images to use.</p></div>
</dd>
<dt id="saev.config.Visuals.include_latents"><code class="name">var <span class="ident">include_latents</span> : list[int]</code></dt>
<dd>
<div class="desc"><p>Latents to always include, no matter what.</p></div>
</dd>
<dt id="saev.config.Visuals.log_freq_range"><code class="name">var <span class="ident">log_freq_range</span> : tuple[float, float]</code></dt>
<dd>
<div class="desc"><p>Log10 frequency range for which to save images.</p></div>
</dd>
<dt id="saev.config.Visuals.log_value_range"><code class="name">var <span class="ident">log_value_range</span> : tuple[float, float]</code></dt>
<dd>
<div class="desc"><p>Log10 frequency range for which to save images.</p></div>
</dd>
<dt id="saev.config.Visuals.n_distributions"><code class="name">var <span class="ident">n_distributions</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of features to save distributions for.</p></div>
</dd>
<dt id="saev.config.Visuals.n_latents"><code class="name">var <span class="ident">n_latents</span> : int</code></dt>
<dd>
<div class="desc"><p>Maximum number of latents to save images for.</p></div>
</dd>
<dt id="saev.config.Visuals.n_workers"><code class="name">var <span class="ident">n_workers</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of dataloader workers.</p></div>
</dd>
<dt id="saev.config.Visuals.percentile"><code class="name">var <span class="ident">percentile</span> : int</code></dt>
<dd>
<div class="desc"><p>Percentile to estimate for outlier detection.</p></div>
</dd>
<dt id="saev.config.Visuals.sae_batch_size"><code class="name">var <span class="ident">sae_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Batch size for SAE inference.</p></div>
</dd>
<dt id="saev.config.Visuals.seed"><code class="name">var <span class="ident">seed</span> : int</code></dt>
<dd>
<div class="desc"><p>Random seed.</p></div>
</dd>
<dt id="saev.config.Visuals.sort_by"><code class="name">var <span class="ident">sort_by</span> : Literal['cls', 'img', 'patch']</code></dt>
<dd>
<div class="desc"><p>How to find the top k images. 'cls' picks images where the SAE latents of the ViT's [CLS] token are maximized without any patch highligting. 'img' picks images that maximize the sum of an SAE latent over all patches in the image, highlighting the patches. 'patch' pickes images that maximize an SAE latent over all patches (not summed), highlighting the patches and only showing unique images.</p></div>
</dd>
<dt id="saev.config.Visuals.top_k"><code class="name">var <span class="ident">top_k</span> : int</code></dt>
<dd>
<div class="desc"><p>How many images per SAE feature to store.</p></div>
</dd>
<dt id="saev.config.Visuals.topk_batch_size"><code class="name">var <span class="ident">topk_batch_size</span> : int</code></dt>
<dd>
<div class="desc"><p>Number of examples to apply top-k op to.</p></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="saev.config.Visuals.distributions_fpath"><code class="name">prop <span class="ident">distributions_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def distributions_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;distributions.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Visuals.mean_values_fpath"><code class="name">prop <span class="ident">mean_values_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def mean_values_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;mean_values.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Visuals.percentiles_fpath"><code class="name">prop <span class="ident">percentiles_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def percentiles_fpath(self) -&gt; str:
    return os.path.join(self.root, f&#34;percentiles_p{self.percentile}.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Visuals.root"><code class="name">prop <span class="ident">root</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def root(self) -&gt; str:
    return os.path.join(self.dump_to, f&#34;sort_by_{self.sort_by}&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Visuals.sparsity_fpath"><code class="name">prop <span class="ident">sparsity_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def sparsity_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;sparsity.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Visuals.top_img_i_fpath"><code class="name">prop <span class="ident">top_img_i_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def top_img_i_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;top_img_i.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Visuals.top_patch_i_fpath"><code class="name">prop <span class="ident">top_patch_i_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def top_patch_i_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;top_patch_i.pt&#34;)</code></pre>
</details>
</dd>
<dt id="saev.config.Visuals.top_values_fpath"><code class="name">prop <span class="ident">top_values_fpath</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def top_values_fpath(self) -&gt; str:
    return os.path.join(self.root, &#34;top_values.pt&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul>
<li><a href="#import-times">Import Times</a></li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="saev" href="index.html">saev</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="saev.config.expand" href="#saev.config.expand">expand</a></code></li>
<li><code><a title="saev.config.grid" href="#saev.config.grid">grid</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="saev.config.Activations" href="#saev.config.Activations">Activations</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.Activations.cls_token" href="#saev.config.Activations.cls_token">cls_token</a></code></li>
<li><code><a title="saev.config.Activations.d_vit" href="#saev.config.Activations.d_vit">d_vit</a></code></li>
<li><code><a title="saev.config.Activations.data" href="#saev.config.Activations.data">data</a></code></li>
<li><code><a title="saev.config.Activations.device" href="#saev.config.Activations.device">device</a></code></li>
<li><code><a title="saev.config.Activations.dump_to" href="#saev.config.Activations.dump_to">dump_to</a></code></li>
<li><code><a title="saev.config.Activations.log_to" href="#saev.config.Activations.log_to">log_to</a></code></li>
<li><code><a title="saev.config.Activations.n_patches_per_img" href="#saev.config.Activations.n_patches_per_img">n_patches_per_img</a></code></li>
<li><code><a title="saev.config.Activations.n_patches_per_shard" href="#saev.config.Activations.n_patches_per_shard">n_patches_per_shard</a></code></li>
<li><code><a title="saev.config.Activations.n_workers" href="#saev.config.Activations.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.Activations.seed" href="#saev.config.Activations.seed">seed</a></code></li>
<li><code><a title="saev.config.Activations.slurm" href="#saev.config.Activations.slurm">slurm</a></code></li>
<li><code><a title="saev.config.Activations.slurm_acct" href="#saev.config.Activations.slurm_acct">slurm_acct</a></code></li>
<li><code><a title="saev.config.Activations.ssl" href="#saev.config.Activations.ssl">ssl</a></code></li>
<li><code><a title="saev.config.Activations.vit_batch_size" href="#saev.config.Activations.vit_batch_size">vit_batch_size</a></code></li>
<li><code><a title="saev.config.Activations.vit_ckpt" href="#saev.config.Activations.vit_ckpt">vit_ckpt</a></code></li>
<li><code><a title="saev.config.Activations.vit_family" href="#saev.config.Activations.vit_family">vit_family</a></code></li>
<li><code><a title="saev.config.Activations.vit_layers" href="#saev.config.Activations.vit_layers">vit_layers</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.Ade20kDataset" href="#saev.config.Ade20kDataset">Ade20kDataset</a></code></h4>
<ul class="">
<li><code><a title="saev.config.Ade20kDataset.n_imgs" href="#saev.config.Ade20kDataset.n_imgs">n_imgs</a></code></li>
<li><code><a title="saev.config.Ade20kDataset.root" href="#saev.config.Ade20kDataset.root">root</a></code></li>
<li><code><a title="saev.config.Ade20kDataset.split" href="#saev.config.Ade20kDataset.split">split</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.DataLoad" href="#saev.config.DataLoad">DataLoad</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.DataLoad.clamp" href="#saev.config.DataLoad.clamp">clamp</a></code></li>
<li><code><a title="saev.config.DataLoad.layer" href="#saev.config.DataLoad.layer">layer</a></code></li>
<li><code><a title="saev.config.DataLoad.n_random_samples" href="#saev.config.DataLoad.n_random_samples">n_random_samples</a></code></li>
<li><code><a title="saev.config.DataLoad.patches" href="#saev.config.DataLoad.patches">patches</a></code></li>
<li><code><a title="saev.config.DataLoad.scale_mean" href="#saev.config.DataLoad.scale_mean">scale_mean</a></code></li>
<li><code><a title="saev.config.DataLoad.scale_norm" href="#saev.config.DataLoad.scale_norm">scale_norm</a></code></li>
<li><code><a title="saev.config.DataLoad.shard_root" href="#saev.config.DataLoad.shard_root">shard_root</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.ImageFolderDataset" href="#saev.config.ImageFolderDataset">ImageFolderDataset</a></code></h4>
<ul class="">
<li><code><a title="saev.config.ImageFolderDataset.n_imgs" href="#saev.config.ImageFolderDataset.n_imgs">n_imgs</a></code></li>
<li><code><a title="saev.config.ImageFolderDataset.root" href="#saev.config.ImageFolderDataset.root">root</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.ImagenetDataset" href="#saev.config.ImagenetDataset">ImagenetDataset</a></code></h4>
<ul class="">
<li><code><a title="saev.config.ImagenetDataset.n_imgs" href="#saev.config.ImagenetDataset.n_imgs">n_imgs</a></code></li>
<li><code><a title="saev.config.ImagenetDataset.name" href="#saev.config.ImagenetDataset.name">name</a></code></li>
<li><code><a title="saev.config.ImagenetDataset.split" href="#saev.config.ImagenetDataset.split">split</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.SparseAutoencoder" href="#saev.config.SparseAutoencoder">SparseAutoencoder</a></code></h4>
<ul class="">
<li><code><a title="saev.config.SparseAutoencoder.d_sae" href="#saev.config.SparseAutoencoder.d_sae">d_sae</a></code></li>
<li><code><a title="saev.config.SparseAutoencoder.d_vit" href="#saev.config.SparseAutoencoder.d_vit">d_vit</a></code></li>
<li><code><a title="saev.config.SparseAutoencoder.exp_factor" href="#saev.config.SparseAutoencoder.exp_factor">exp_factor</a></code></li>
<li><code><a title="saev.config.SparseAutoencoder.ghost_grads" href="#saev.config.SparseAutoencoder.ghost_grads">ghost_grads</a></code></li>
<li><code><a title="saev.config.SparseAutoencoder.n_reinit_samples" href="#saev.config.SparseAutoencoder.n_reinit_samples">n_reinit_samples</a></code></li>
<li><code><a title="saev.config.SparseAutoencoder.normalize_w_dec" href="#saev.config.SparseAutoencoder.normalize_w_dec">normalize_w_dec</a></code></li>
<li><code><a title="saev.config.SparseAutoencoder.remove_parallel_grads" href="#saev.config.SparseAutoencoder.remove_parallel_grads">remove_parallel_grads</a></code></li>
<li><code><a title="saev.config.SparseAutoencoder.seed" href="#saev.config.SparseAutoencoder.seed">seed</a></code></li>
<li><code><a title="saev.config.SparseAutoencoder.sparsity_coeff" href="#saev.config.SparseAutoencoder.sparsity_coeff">sparsity_coeff</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.Train" href="#saev.config.Train">Train</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.Train.ckpt_path" href="#saev.config.Train.ckpt_path">ckpt_path</a></code></li>
<li><code><a title="saev.config.Train.data" href="#saev.config.Train.data">data</a></code></li>
<li><code><a title="saev.config.Train.device" href="#saev.config.Train.device">device</a></code></li>
<li><code><a title="saev.config.Train.log_every" href="#saev.config.Train.log_every">log_every</a></code></li>
<li><code><a title="saev.config.Train.log_to" href="#saev.config.Train.log_to">log_to</a></code></li>
<li><code><a title="saev.config.Train.lr" href="#saev.config.Train.lr">lr</a></code></li>
<li><code><a title="saev.config.Train.n_lr_warmup" href="#saev.config.Train.n_lr_warmup">n_lr_warmup</a></code></li>
<li><code><a title="saev.config.Train.n_patches" href="#saev.config.Train.n_patches">n_patches</a></code></li>
<li><code><a title="saev.config.Train.n_sparsity_warmup" href="#saev.config.Train.n_sparsity_warmup">n_sparsity_warmup</a></code></li>
<li><code><a title="saev.config.Train.n_workers" href="#saev.config.Train.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.Train.sae" href="#saev.config.Train.sae">sae</a></code></li>
<li><code><a title="saev.config.Train.sae_batch_size" href="#saev.config.Train.sae_batch_size">sae_batch_size</a></code></li>
<li><code><a title="saev.config.Train.seed" href="#saev.config.Train.seed">seed</a></code></li>
<li><code><a title="saev.config.Train.slurm" href="#saev.config.Train.slurm">slurm</a></code></li>
<li><code><a title="saev.config.Train.slurm_acct" href="#saev.config.Train.slurm_acct">slurm_acct</a></code></li>
<li><code><a title="saev.config.Train.tag" href="#saev.config.Train.tag">tag</a></code></li>
<li><code><a title="saev.config.Train.track" href="#saev.config.Train.track">track</a></code></li>
<li><code><a title="saev.config.Train.wandb_project" href="#saev.config.Train.wandb_project">wandb_project</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="saev.config.Visuals" href="#saev.config.Visuals">Visuals</a></code></h4>
<ul class="two-column">
<li><code><a title="saev.config.Visuals.ckpt" href="#saev.config.Visuals.ckpt">ckpt</a></code></li>
<li><code><a title="saev.config.Visuals.data" href="#saev.config.Visuals.data">data</a></code></li>
<li><code><a title="saev.config.Visuals.device" href="#saev.config.Visuals.device">device</a></code></li>
<li><code><a title="saev.config.Visuals.distributions_fpath" href="#saev.config.Visuals.distributions_fpath">distributions_fpath</a></code></li>
<li><code><a title="saev.config.Visuals.dump_to" href="#saev.config.Visuals.dump_to">dump_to</a></code></li>
<li><code><a title="saev.config.Visuals.epsilon" href="#saev.config.Visuals.epsilon">epsilon</a></code></li>
<li><code><a title="saev.config.Visuals.images" href="#saev.config.Visuals.images">images</a></code></li>
<li><code><a title="saev.config.Visuals.include_latents" href="#saev.config.Visuals.include_latents">include_latents</a></code></li>
<li><code><a title="saev.config.Visuals.log_freq_range" href="#saev.config.Visuals.log_freq_range">log_freq_range</a></code></li>
<li><code><a title="saev.config.Visuals.log_value_range" href="#saev.config.Visuals.log_value_range">log_value_range</a></code></li>
<li><code><a title="saev.config.Visuals.mean_values_fpath" href="#saev.config.Visuals.mean_values_fpath">mean_values_fpath</a></code></li>
<li><code><a title="saev.config.Visuals.n_distributions" href="#saev.config.Visuals.n_distributions">n_distributions</a></code></li>
<li><code><a title="saev.config.Visuals.n_latents" href="#saev.config.Visuals.n_latents">n_latents</a></code></li>
<li><code><a title="saev.config.Visuals.n_workers" href="#saev.config.Visuals.n_workers">n_workers</a></code></li>
<li><code><a title="saev.config.Visuals.percentile" href="#saev.config.Visuals.percentile">percentile</a></code></li>
<li><code><a title="saev.config.Visuals.percentiles_fpath" href="#saev.config.Visuals.percentiles_fpath">percentiles_fpath</a></code></li>
<li><code><a title="saev.config.Visuals.root" href="#saev.config.Visuals.root">root</a></code></li>
<li><code><a title="saev.config.Visuals.sae_batch_size" href="#saev.config.Visuals.sae_batch_size">sae_batch_size</a></code></li>
<li><code><a title="saev.config.Visuals.seed" href="#saev.config.Visuals.seed">seed</a></code></li>
<li><code><a title="saev.config.Visuals.sort_by" href="#saev.config.Visuals.sort_by">sort_by</a></code></li>
<li><code><a title="saev.config.Visuals.sparsity_fpath" href="#saev.config.Visuals.sparsity_fpath">sparsity_fpath</a></code></li>
<li><code><a title="saev.config.Visuals.top_img_i_fpath" href="#saev.config.Visuals.top_img_i_fpath">top_img_i_fpath</a></code></li>
<li><code><a title="saev.config.Visuals.top_k" href="#saev.config.Visuals.top_k">top_k</a></code></li>
<li><code><a title="saev.config.Visuals.top_patch_i_fpath" href="#saev.config.Visuals.top_patch_i_fpath">top_patch_i_fpath</a></code></li>
<li><code><a title="saev.config.Visuals.top_values_fpath" href="#saev.config.Visuals.top_values_fpath">top_values_fpath</a></code></li>
<li><code><a title="saev.config.Visuals.topk_batch_size" href="#saev.config.Visuals.topk_batch_size">topk_batch_size</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.3</a>.</p>
</footer>
</body>
</html>
